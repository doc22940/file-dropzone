/*
 * loopRequest v1.0.0
 * https://github.com/zhanziyang/file-dropzone
 * 
 * Copyright (c) 2017 zhanziyang
 * Released under the MIT license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):e.FileDropzone=t(e.jQuery)}(this,function(e){"use strict";function t(){e("<style>.dropzone--clickable { cursor: pointer; }</style>").appendTo("head")}function i(e){this.disabled||(e.preventDefault(),this.options.onEnter&&this.options.onEnter(e),this.element.addClass(this.options.fileHoverClass))}function n(e){this.disabled||(e.preventDefault(),this.options.onLeave&&this.options.onLeave(e),this.element.removeClass(this.options.fileHoverClass))}function o(e){this.disabled||(e.preventDefault(),this.options.onHover&&this.options.onHover(e))}function s(e){if(!this.disabled){e.preventDefault(),this.options.onDrop&&this.options.onDrop(e),this.element.removeClass(this.options.fileHoverClass);var t=e.dataTransfer||e.originalEvent.dataTransfer,i=[];if(t.items&&t.items.length)for(var n=0,o=t.items.length;n<o;n++){var s=t.items[n];"file"===s.kind&&i.push(s.getAsFile())}else i=t.files;this.addFiles(i)}}e=e&&"default"in e?e.default:e;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),f={isString:function(e){return"string"==typeof e||e instanceof String},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return e&&"object"===(void 0===e?"undefined":r(e))&&!isArray(e)},addUnique:function(e,t){return e.indexOf(t)<0&&e.push(t),e},remove:function(e,t){var i=e.indexOf(t);return i>=0&&e.splice(i,1),e},assign:function(e,t){if(!e||!t)return e;for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},without:function(e,t){var i,n,o,s;for(s=[],n=0,o=e.length;n<o;n++)(i=e[n])!==t&&s.push(i);return s},fileTypeValid:function(e,t){if(!t)return!0;var i=t.replace(/\/.*$/,""),n=t.split(","),o=!0,s=!1,r=void 0;try{for(var l,a=n[Symbol.iterator]();!(o=(l=a.next()).done);o=!0){var f=l.value.trim();if(/^\./.test(f)){if(e.name.toLowerCase().split(".").pop()===f.toLowerCase())return!0}else if(e.type.replace(/\/.*$/,"")===i)return!0}}catch(e){s=!0,r=e}finally{try{!o&&a.return&&a.return()}finally{if(s)throw r}}return!1}},u=function(){},p={target:"",fileHoverClass:"dropzone--file-hover",clickable:!0,multiple:!0,paramName:"file",accept:"",capture:!0,unique:!1,onChange:u,onEnter:u,onLeave:u,onHover:u,onDrop:u,onSomeInvalid:u};return function(){function r(t,i){l(this,r);var n=i||{},o=e(t);if(f.isString(t)||!f.isObject(t)||t instanceof e||t instanceof Element||(o=e((n=t||{}).target)),!o||o.length<=0)throw new Error("No matched element.");this.element=o,this.options=f.assign(p,n),this.disabled=!1,this.files=[],this.fileInput=null,this.multiple=!1,this.init()}return a(r,[{key:"init",value:function(){this.options.clickable&&(this.element.addClass("dropzone--clickable"),this.element.on("click",this.openFileChooser.bind(this))),this.multiple=this.options.multiple||this.element.find("input[type=file]").attr("multiple")||!1,(!this.element.find("input[type=file]")||this.element.find("input[type=file]").length<=0)&&this.element.append('<input type="file" hidden name="'+this.options.paramName+'" class="'+this.options.paramName+'" >'),this.fileInput=this.element.find("input[type=file]"),this.multiple&&this.fileInput.attr("multiple","multiple"),this.options.capture&&this.fileInput.attr("capture",this.options.capture),this.options.accept&&this.fileInput.attr("accept",this.options.accept),this.element.on("dragenter",i.bind(this)).on("dragleave",n.bind(this)).on("dragend",n.bind(this)).on("dragover",o.bind(this)).on("drop",s.bind(this));var r=this;this.fileInput.on("click",function(e){e.stopPropagation()}).on("change",function(t){if(!r.disabled){for(var i=t.target.files,n=[],o=0,s=i.length;o<s;o++){var l=i[o];l instanceof File&&n.push(l)}r.addFiles(n),r.options.unique||e(this).val("")}}),t()}},{key:"addFiles",value:function(e){var t=this,i=[],n=[];if(e.forEach(function(e){f.fileTypeValid(e,t.accept)?(!t.options.unique||t.files.indexOf(e)<0)&&i.push(e):n.push(e)}),n.length&&this.onSomeInvalid&&this.onSomeInvalid(n),i[0]){if(!this.multiple){if(this.files.length>0)return;i=i.slice(0,1)}this.files=this.files.concat(i),this.options.onChange&&this.options.onChange()}}},{key:"removeFile",value:function(e){var t=this.files.length;this.files=f.without(this.files,e),this.files.length<t&&this.options.onChange&&this.options.onChange()}},{key:"openFileChooser",value:function(){this.fileInput.click()}},{key:"clearAll",value:function(){this.files=[],this.options.onChange&&this.options.onChange()}},{key:"disable",value:function(){this.disabled=!0,this.element.addClass("dropzone--disabled"),this.fileInput.prop("disabled",!0)}},{key:"enable",value:function(){this.disabled=!1,this.element.removeClass("dropzone--disabled"),this.fileInput.prop("disabled",!1)}}],[{key:"getFileSize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"b",i=["b","kb","mb","gb","tb"];if(!(e instanceof File))throw new TypeError('First argument "file" should be a File instance.');if(t&&"string"==typeof t||(t="b"),"b"==t)return e.size;var n=i.indexOf(t.toLowerCase);if(n<0)throw new TypeError('The unit should be one of "tb", "gb", "mb", "kb" and "b", the default value is "b"');return e.size/Math.pow(1024,n-1)}}]),r}()});
