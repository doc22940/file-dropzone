/*
 * loopRequest v1.0.6
 * https://github.com/zhanziyang/file-dropzone
 * 
 * Copyright (c) 2017 zhanziyang
 * Released under the MIT license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):e.FileDropzone=t(e.jQuery)}(this,function(e){"use strict";function t(e){var t=this,i=[],n=[];if(e.forEach(function(e){p.fileTypeValid(e,t.options.accept)?(!t.options.unique||t.getFiles().indexOf(e)<0)&&i.push(e):n.push(e)}),n.length&&this.options.onInvalid&&this.options.onInvalid.bind(this)(n),i[0]){this.multiple||(i=i.slice(0,1));var o=!0;if(this.options.beforeAdd){var s=this.options.beforeAdd.bind(this)(i);"boolean"==typeof s&&(o=s)}o&&(!this.multiple||this.options.forceReplace?d.bind(this)(i):d.bind(this)(this.getFiles().concat(i)),this.options.onChange&&this.options.onChange.bind(this)())}}function i(){e("<style>.dropzone--clickable { cursor: pointer; }</style>").appendTo("head")}function n(e){this.disabled||(e.preventDefault(),1==++b&&(this.options.onEnter&&this.options.onEnter.bind(this)(e),this.element.addClass(this.options.fileHoverClass)))}function o(e){this.disabled||(e.preventDefault(),0===--b&&(this.options.onLeave&&this.options.onLeave.bind(this)(e),this.element.removeClass(this.options.fileHoverClass)))}function s(e){this.disabled||(e.preventDefault(),this.options.onHover&&this.options.onHover.bind(this)(e))}function r(e){if(!this.disabled){e.preventDefault(),b--,this.options.onDrop&&this.options.onDrop.bind(this)(e),this.element.removeClass(this.options.fileHoverClass);var i=e.dataTransfer||e.originalEvent.dataTransfer,n=[];if(i.items&&i.items.length)for(var o=0,s=i.items.length;o<s;o++){var r=i.items[o];"file"===r.kind&&n.push(r.getAsFile())}else n=i.files;t.bind(this)(n)}}function l(e){this.disabled||this.clickable&&this.openFileChooser()}e=e&&"default"in e?e.default:e;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),p={isString:function(e){return"string"==typeof e||e instanceof String},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return e&&"object"===(void 0===e?"undefined":a(e))&&!this.isArray(e)},addUnique:function(e,t){return e.indexOf(t)<0&&e.push(t),e},remove:function(e,t){var i=e.indexOf(t);return i>=0&&e.splice(i,1),e},assign:function(e,t){if(!e||!t)return e;for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},without:function(e,t){var i,n,o,s;for(s=[],n=0,o=e.length;n<o;n++)(i=e[n])!==t&&s.push(i);return s},fileTypeValid:function(e,t){if(!t)return!0;var i=t.replace(/\/.*$/,""),n=t.split(","),o=!0,s=!1,r=void 0;try{for(var l,a=n[Symbol.iterator]();!(o=(l=a.next()).done);o=!0){var h=l.value,u=h.trim();if(/^\./.test(u)){if(e.name.toLowerCase().split(".").pop()===u.toLowerCase())return!0}else if(/\/\*$/.test(u)){if(e.type.replace(/\/.*$/,"")===i)return!0}else if(e.type===h)return!0}}catch(e){s=!0,r=e}finally{try{!o&&a.return&&a.return()}finally{if(s)throw r}}return!1}},f=function(){},c=[],d=function(e){c=e},b=0,v={target:"",fileHoverClass:"dropzone--file-hover",clickable:!0,multiple:!0,paramName:"file",accept:"",capture:!0,unique:!1,forceReplace:!1,onChange:f,onEnter:f,onLeave:f,onHover:f,onDrop:f,onInvalid:f,beforeAdd:f};return function(){function a(t,i){h(this,a);var n=i||{},o=e(t);if(p.isString(t)||!p.isObject(t)||t instanceof e||t instanceof Element||(o=e((n=t||{}).target)),!o||o.length<=0)throw new Error("No matched element.");this.element=o,this.options=p.assign(v,n),this.disabled=!1,this.fileInput=null,this.multiple=!1,this.init()}return u(a,[{key:"init",value:function(){d.bind(this)([]),this.clickable=this.options.clickable,this.clickable&&this.element.addClass("dropzone--clickable"),this.element[0].addEventListener("click",l.bind(this)),this.multiple="boolean"!=typeof this.options.multiple||this.options.multiple,this.fileInput=e('<input type="file" hidden name="'+this.options.paramName+'" class="'+this.options.paramName+'" >'),this.element.next(this.fileInput),this.multiple&&this.fileInput.attr("multiple","multiple"),this.options.capture&&this.fileInput.attr("capture",this.options.capture),this.options.accept&&this.fileInput.attr("accept",this.options.accept),this.element.on("dragenter",n.bind(this)).on("dragleave",o.bind(this)).on("dragend",o.bind(this)).on("dragover",s.bind(this)).on("drop",r.bind(this));var a=this;this.fileInput.on("click",function(e){e.stopPropagation()}).on("change",function(i){if(!a.disabled){for(var n=i.target.files,o=[],s=0,r=n.length;s<r;s++){var l=n[s];l instanceof File&&o.push(l)}t.bind(a)(o),a.options.unique||e(this).val("")}}),i()}},{key:"getFiles",value:function(){return c}},{key:"removeFile",value:function(e){var t=this.getFiles(),i=t.length;t=p.without(t,e),d(t),t.length<i&&this.options.onChange&&this.options.onChange.bind(this)()}},{key:"pop",value:function(){var e=this.getFiles(),t=e.pop();return d.bind(this)(e),this.options.onChange&&this.options.onChange.bind(this)(),t}},{key:"openFileChooser",value:function(){this.fileInput.click()}},{key:"clearAll",value:function(){d.bind(this)([]),this.options.onChange&&this.options.onChange.bind(this)()}},{key:"disable",value:function(){this.disabled=!0,this.element.addClass("dropzone--disabled"),this.fileInput.prop("disabled",!0)}},{key:"enable",value:function(){this.disabled=!1,this.element.removeClass("dropzone--disabled"),this.fileInput.prop("disabled",!1)}},{key:"disableClick",value:function(){this.clickable=!1}},{key:"enableClick",value:function(){this.clickable=!0}}],[{key:"getFileSize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"b",i=["b","kb","mb","gb","tb"];if(!(e instanceof File))throw new TypeError('First argument "file" should be a File instance.');if(t&&"string"==typeof t||(t="b"),"b"==t)return e.size;var n=i.indexOf(t.toLowerCase());if(n<0)throw new TypeError('The unit should be one of "tb", "gb", "mb", "kb" and "b", the default value is "b"');return e.size/Math.pow(1024,n)}}]),a}()});
