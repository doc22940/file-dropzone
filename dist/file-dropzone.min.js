/*
 * loopRequest v1.0.0
 * https://github.com/zhanziyang/file-dropzone
 * 
 * Copyright (c) 2017 zhanziyang
 * Released under the MIT license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):e.FileDropzone=t(e.jQuery)}(this,function(e){"use strict";e=e&&"default"in e?e.default:e;var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o={isString:function(e){return"string"==typeof e||e instanceof String},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return e&&"object"===(void 0===e?"undefined":t(e))&&!isArray(e)},addUnique:function(e,t){return e.indexOf(t)<0&&e.push(t),e},remove:function(e,t){var n=e.indexOf(t);return n>=0&&e.splice(n,1),e},assign:function(e,t){if(!e||!t)return e;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}},r={fileHoverClass:"dropzone--file-hover",clickable:!0,paramName:"file",onFileChoose:function(){},onDragEnter:function(){},onDragLeave:function(){},onDragOver:function(){},onDrop:function(){}};return function(){function t(i,a){n(this,t);var s=a||{},l=e(i);if(o.isString(i)||!o.isObject(i)||i instanceof e||i instanceof Element||(l=e((s=i||{}).target)),!l||l.length<=0)throw new Error("No matched element.");this.target=l,this.options=o.assign(r,s),this.disabled=!1,this.init()}return i(t,[{key:"init",value:function(){var e=this;this.options.clickable&&this.target.addClass("dropzone--clickable"),(!this.target.find("input[type=file]")||this.target.find("input[type=file]").length<=0)&&this.target.append('<input type="file" hidden name="'+this.options.paramName+'" class="'+this.options.paramName+'" >'),this.fileInput=this.target.find("input[type=file]"),this.target.on("dragenter",this._handleDragEnter.bind(this)).on("dragleave",this._handleDragLeave.bind(this)).on("dragover",this._handleDragOver.bind(this)).on("drop",this._handleDrop.bind(this)).on("click",this._handleClick.bind(this)),this.fileInput.on("click",function(e){e.stopPropagation()}).on("change",function(t){e.disabled||(e.file=t.target.files[0],e.options.onFileChoose&&e.options.onFileChoose())})}},{key:"_handleDragEnter",value:function(e){this.disabled||(e.preventDefault(),this.options.onDragEnter&&this.options.onDragEnter(e),this.target.addClass(this.options.fileHoverClass))}},{key:"_handleDragLeave",value:function(e){this.disabled||(e.preventDefault(),this.options.onDragLeave&&this.options.onDragLeave(e),this.target.removeClass(this.options.fileHoverClass))}},{key:"_handleDragOver",value:function(e){this.disabled||(e.preventDefault(),this.options.onDragOver&&this.options.onDragOver(e))}},{key:"_handleDrop",value:function(e){if(!this.disabled){e.preventDefault(),this.options.onDrop&&this.options.onDrop(e),this.target.removeClass(this.options.fileHoverClass);var t=e.dataTransfer||e.originalEvent.dataTransfer,n=void 0;if(t.items&&t.items.length){var i=!0,o=!1,r=void 0;try{for(var a,s=t.items[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var l=a.value;"file"===l.kind&&(n=l.getAsFile())}}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}}else n=t.files[0];this.file=n,this.options.onFileChoose&&this.options.onFileChoose()}}},{key:"_handleClick",value:function(e){this.disabled||this.options.clickable&&this.openFileChooser()}},{key:"openFileChooser",value:function(){this.fileInput.value=null,this.fileInput.click()}},{key:"getCurrentFile",value:function(){return this.file}},{key:"disable",value:function(){this.disabled=!0,this.target.addClass("dropzone--disabled")}},{key:"enable",value:function(){this.disabled=!1,this.target.removeClass("dropzone--disabled")}}]),t}()});
